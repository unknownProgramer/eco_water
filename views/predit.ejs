<!DOCTYPE html>
<html lang="en">
<head>
    <%- include ('header.ejs') %>
</head>

<body class="g-sidenav-show  bg-gray-200">
<aside class="sidenav navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-3 bg-gradient-dark GOTHIC_M"
       id="sidenav-main">
    <div class="sidenav-header">
        <i class="fas fa-times p-3 cursor-pointer text-white opacity-5 position-absolute end-0 top-0 d-none d-xl-none"
           aria-hidden="true" id="iconSidenav"></i>
        <a class="navbar-brand m-0" href="/">
            <img src="img/observation-icon.png" class="navbar-brand-img h-100" alt="main_logo">
            <span class="ms-1 text-white">평림댐 관측 프로그램</span>
        </a>
    </div>
    <hr class="horizontal light mt-0 mb-2">
    <div class="collapse navbar-collapse w-auto" id="sidenav-collapse-main">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link text-white active bg-gradient-info" href="/">
                    <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="material-icons opacity-10">dashboard</i>
                    </div>
                    <span class="nav-link-text ms-1">메인</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-white" href="/info">
                    <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="material-icons opacity-10">info</i>
                    </div>
                    <span class="nav-link-text ms-1">평림댐 정보</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-white" href="/pred">
                    <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="material-icons opacity-10">opacity</i>
                    </div>
                    <span class="nav-link-text ms-1">평림댐 수위 / 수량예측</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-white" href="/predit">
                    <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="material-icons opacity-10">assignment</i>
                    </div>
                    <span class="nav-link-text ms-1">평림댐 수질정보 / 예측</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-white" href="/noFunction">
                    <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="material-icons opacity-10">adjust</i>
                    </div>
                    <span class="nav-link-text ms-1">ECO-SYSTEM 관리</span>
                </a>
            </li>
            <hr class="horizontal light mt-5 mb-2">
            <li class="nav-item">
                <a class="nav-link text-white " href="/noFunction">
                    <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="material-icons opacity-10">login</i>
                    </div>
                    <span class="nav-link-text ms-1">로그인</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-white" href="https://www.ecopeace.kr">
                    <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="material-icons opacity-10">backup_table</i>
                    </div>
                    <span class="nav-link-text ms-1">에코피스 홈페이지 이동</span>
                </a>
            </li>
        </ul>
    </div>
</aside>
<main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg ">

    <!-- 전체 container 시작-->
    <div class="container-fluid px-2 px-md-4">

        <!-- 타이틀 시작 -->
        <div class="page-header min-height-300 border-radius-xl mt-3" style="background-image: url('img/title.jpg');">
            <span class="mask GOTHIC_M"
                  style="color: #ffffff; font-size: 48px; font-weight: 500; margin-top: 120px; padding-left: 30px">수위예측 3D 디스플레이 시스템</span>
            <span class="mask GOTHIC_M" style="color: #000000; font-size: 28px; margin-top: 180px; padding-left: 30px">평림댐 수질정보 / 예측</span>
        </div>
        <!-- 타이틀 끝 -->

        <!-- 전체 보드 시작 -->
        <div class="card card-body mx-3 mx-md-4 mt-n6">
            <div class="row gx-4 mb-2">

                <!-- 3D 렌더링 캔버스 시작-->
                <div class="col">
                    <canvas id="lender_canvas"></canvas>
                    <hr class="mb-1">
                    <button id="getDataButton" onclick="getLiverColor()">데이터 가져오기</button>
                    <div class="mx-3 mt-2">
                        <p class="GOTHIC_M mb-0" style="font-size: 14px">사용법</p>
                        <p class="GOTHIC_M mb-0" style="font-size: 14px">마우스 왼쪽 클릭 후 이동 : 객체 상,하,좌,우 회전</p>
                        <p class="GOTHIC_M mb-0" style="font-size: 14px">마우스 오른쪽 클릭 후 이동 : 객체 상,하,좌,우 이동</p>
                        <p class="GOTHIC_M mb-0" style="font-size: 14px">shift + 휠 : 객체 줌 인, 줌 아웃</p>
                    </div>
                    <hr class="mb-1">
                </div>
                <!-- 3D 렌더링 캔버스 끝-->

                <!-- 수위, 수량 container 시작-->
                <div class="col">
                    <div class="card_title mb-5 mt-5 GOTHIC_M" style="text-align: center">
                        <h1>현재 수량 및 수위 정보</h1>
                        <h3></h3>
                    </div>

                    <!-- 오늘의 수위 display -->
                    <div class="card mx-7 GOTHIC_M">
                        <div class="card-header p-3 pt-2">
                            <div class="icon icon-lg icon-shape bg-gradient-info shadow-dark text-center border-radius-xl mt-n4 position-absolute">
                                <i class="material-icons opacity-10">water</i>
                            </div>
                            <div class="text-end pt-0">
                                <p class="text-xl mb-0">현재 수위</p>
                                <h4 class="mb-0"><b style="color: #0d6efd"></b> m</h4>
                                <p class="text-sm mb-0 text-black-50">(최저지점 기준)</p>
                            </div>
                        </div>
                        <hr class="dark horizontal my-0">
                        <div class="card-footer p-3">
                            <p class="mb-0">1주 전에 비해 <span
                                        class="text-success text-sm font-weight-bolder"></span>
                            </p>
                        </div>
                    </div>
                    <!-- 오늘의 수위 display 끝 -->

                    <!-- 오늘의 수량 display -->
                    <div class="card mt-5 mx-7 GOTHIC_M">
                        <div class="card-header p-3 pt-2">
                            <div class="icon icon-lg icon-shape bg-gradient-info shadow-dark text-center border-radius-xl mt-n4 position-absolute">
                                <i class="material-icons opacity-10">opacity</i>
                            </div>
                            <div class="text-end pt-1">
                                <p class="text-xl mb-0">현재 수량</p>
                                <h4 class="mb-0 GULIM">약 <b
                                            style="color: #0d6efd"></b> ㎥
                                </h4>
                                <p class="text-sm mb-0 text-black-50">(자정 기준)</p>
                            </div>
                        </div>
                        <hr class="dark horizontal my-0">
                        <div class="card-footer p-3">
                            <p class="mb-0">1주 전에 비해 약 <span
                                        class="text-success text-sm font-weight-bolder"></span>
                            </p>
                        </div>
                    </div>
                    <!-- 오늘의 수량 display 끝 -->

                    <p class="text-end mx-7 mt-2 text-black-50">출처 : 공공데이터 포털</p>
                </div>
                <!-- 수위, 수량 container 끝-->

            </div>
        </div>
        <!-- 전체 보드 끝 -->

    </div>

    <footer class="footer py-4  ">
        <div class="container-fluid">
            <div class="row align-items-center justify-content-lg-between">
                <div class="col-lg-6 mb-lg-0 mb-4">
                    <div class="copyright text-center text-sm text-muted text-lg-start">
                        Copyright ©
                        <script>
                            document.write(new Date().getFullYear())
                        </script>
                        ECOPEACE All Right Reserved.
                    </div>
                </div>
            </div>
        </div>
    </footer>

</main>

<!--   Core JS Files   -->
<script src="js/core/popper.min.js"></script>
<script src="js/core/bootstrap.min.js"></script>
<script src="js/plugins/perfect-scrollbar.min.js"></script>
<script src="js/plugins/smooth-scrollbar.min.js"></script>
<script src="js/plugins/chartjs.min.js"></script>

<!-- control script-->
<script>
    const win = navigator.platform.indexOf('Win') > -1;
    if (win && document.querySelector('#sidenav-scrollbar')) {
        const options = {
            damping: '0.5'
        }
        Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
    }
</script>

<!-- 3D display script -->
<script type="importmap">
      {
        "imports": {
          "three": "./build/three.module.js"
        }
      }
</script>

<script>
    const color_result = '<%= color %>';
</script>

<script type="module">
    import * as THREE from 'three';
    import {OrbitControls} from './jsm/controls/OrbitControls.js';
    import {Water} from './jsm/objects/Water2.js';

    let scene, camera, clock, renderer, water;
    let params = {
        '담수 색상': color_result,
        '담수 높이': 45
    };
    
    init();
    animate();

    function init() {
        ///////////////////
        //     SCENE     //
        ///////////////////
        scene = new THREE.Scene();

        /////////////////////
        //      CAMERA     //
        /////////////////////
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(150, 100, 25);
        camera.lookAt(scene.position);

        ///////////////////
        //     CLOCK     //
        ///////////////////
        clock = new THREE.Clock();

        //////////////////////
        //     GEOMETRY     //
        //////////////////////
        // texture load
        const loader = new THREE.TextureLoader();
        const height = loader.load('/depth_img/pd_depth.jpg');
        const texture = loader.load('/depth_img/pd_depth_color.jpg');
        height.warpS = height.wrapT = THREE.RepeatWrapping;

        // 지면 init
        const geometry = new THREE.PlaneGeometry(256, 256, 64, 64)

        // 저수지 수심 init
        const material = new THREE.MeshStandardMaterial({
            color: '#ffffff',
            map: texture,
            displacementMap: height,
            // wireframe: true,
            displacementScale: 64
        });
        material.side = THREE.DoubleSide;

        // 지면 객체 init
        const plane = new THREE.Mesh(geometry, material);

        // 지면 객체 위치조정
        plane.rotation.x = -Math.PI / 2;

        // 지면 객체 추가
        scene.add(plane);

        ///////////////////
        //     WATER     //
        ///////////////////
        const waterGeometry = new THREE.PlaneGeometry(256, 256);

        water = new Water(waterGeometry, {
            color: params["담수 색상"],
            scale: 1,
            flowDirection: new THREE.Vector2(1, 1),
            textureWidth: 128,
            textureHeight: 128
        });
        water.position.y = params["담수 높이"];
        water.rotation.x = Math.PI * -0.5;
        scene.add(water);

        ///////////////////
        //      CUBE     //
        ///////////////////
        const cubeTextureLoader = new THREE.CubeTextureLoader();
        // cubeTextureLoader.setPath( '/skyboxsun25deg/' );
        const cubeTexture = cubeTextureLoader.load([
            'skyboxsun25deg/px.jpg', 'skyboxsun25deg/nx.jpg',
            'skyboxsun25deg/py.jpg', 'skyboxsun25deg/ny.jpg',
            'skyboxsun25deg/pz.jpg', 'skyboxsun25deg/nz.jpg'
        ]);
        scene.background = cubeTexture;

        ///////////////////
        //     LIGHT     //
        ///////////////////
        const ambientLight = new THREE.AmbientLight(0xf0f0f0);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0x808080, 1.0);
        directionalLight.position.set(2, 2, 3);
        scene.add(directionalLight);

        //////////////////////
        //     RENDERER     //
        //////////////////////
        const canvas = document.querySelector('#lender_canvas');
        renderer = new THREE.WebGLRenderer({canvas});
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(840, 480);

        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFShadowMap;

        //////////////////////
        //     CONTROLS     //
        //////////////////////
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.minDistance = 125;
        controls.maxDistance = 350;
        controls.maxPolarAngle = 1;
        window.addEventListener('resize', onWindowResize);
    }

    function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }

    function animate() {
        requestAnimationFrame(animate);
        // scene.rotation.y += 0.02;
        render();
    }

    function render() {
        renderer.render(scene, camera);
    }

</script>

<!-- Github buttons -->
<script async defer src="https://buttons.github.io/buttons.js"></script>

<!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
<script src="js/material-dashboard.min.js?v=3.0.2"></script>
</body>
</html>